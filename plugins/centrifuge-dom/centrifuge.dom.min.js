!function(e){e.extend({centrifuge_dom:function(n){function t(e){h.debug===!0&&console.log(e)}function r(e){var n,t=0;for(n in e)e.hasOwnProperty(n)&&t++;return t}function o(e){return h.fullMessage===!1?e.data:e}function i(e){return h.fullMessage===!1?e.body:e}function u(e){return h.fullMessage===!1?e.error:e}function c(e,n){var r=e.attr(h.channelAttr),o=n.getSubscription(r);return null===o&&t("no subscription found for channel "+r),o}function f(e){e.on("connect",function(){t("connected to Centrifuge"),g(e)}),e.on("error",function(e){t(e)}),e.on("disconnect",function(){t("disconnected from Centrifuge"),v()})}function a(e){x.on(h.eventPrefix+"publish",function(n){var t=$(this),r=c(t,e);r&&r.publish(n)}),x.on(h.eventPrefix+"presence",function(){var n=$(this),t=c(n,e);t&&t.presence(function(e){n.trigger("centrifuge-presence-message",o(e))})}),x.on(h.eventPrefix+"history",function(){var n=$(this),t=c(n,e);t&&t.history(function(e){n.trigger("centrifuge-history-message",o(e))})}),x.on(h.eventPrefix+"unsubscribe",function(){var n=$(this),t=c(n,e);t&&t.unsubscribe()})}function s(e,n){var r=p[e],c=n.subscribe(e,function(e){t(e);var n=r.attr(h.messageEventNameAttr),i=h.eventPrefix+(n||"message");r.trigger(i,o(e))});c.on("subscribe:success",function(e){var n=h.eventPrefix+"subscribe:success";r.trigger(n,i(e))}),c.on("subscribe:error",function(e){t(e);var n=h.eventPrefix+"subscribe:error";r.trigger(n,u(e))}),c.on("join",function(e){t(e);var n=h.eventPrefix+"join";r.trigger(n,o(e))}),c.on("leave",function(e){t(e);var n=h.eventPrefix+"leave";r.trigger(n,o(e))})}function l(e){var n=p[e];n.trigger(h.eventPrefix+"disconnect")}function g(e){for(var n in p)s(n,e)}function v(){for(var e in p)l(e)}function d(){x.each(function(n,t){var r=e(t),o=r.attr(h.channelAttr);p[o]=r})}function m(){if(!Centrifuge)return void console.log("No Centrifuge javascript client found");if(0===x.length)return void t("No Centrifuge handlers found on this page, nothing to do");var e=$(h.tokenSelector).attr(h.valueAttrName);if(!e)return void console.log("Centrifuge token not found");var n=$(h.userSelector).attr(h.valueAttrName);if(!n)return void console.log("Centrifuge user not found");var o=$(h.timestampSelector).attr(h.valueAttrName);if(!o)return void console.log("Centrifuge timestamp not found");var i;if(null===h.url&&(i=$(h.urlSelector).attr(h.valueAttrName)),!i)return void console.log("Centrifuge connection url not found");var u=$(h.infoSelector).attr(h.valueAttrName);u||(t("Centrifuge info not used, token must be generated without info part."),u=null);var c=new Centrifuge({url:i,token:e,user:n,timestamp:o,info:u});return d(c),0===r(p)?void t("No valid handlers found on page, no need in connection to Centrifuge"):(f(c),a(c),void c.connect())}var b={url:null,selector:".centrifuge",urlSelector:"#centrifuge-address",tokenSelector:"#centrifuge-token",userSelector:"#centrifuge-user",timestampSelector:"#centrifuge-timestamp",infoSelector:"#centrifuge-info",valueAttrName:"data-centrifuge-value",channelAttr:"data-centrifuge-channel",messageEventNameAttr:"data-centrifuge-message",eventPrefix:"centrifuge.",fullMessage:!0,debug:!1},h=e.extend(b,n),p={},x=e(h.selector);return m()}})}(jQuery);