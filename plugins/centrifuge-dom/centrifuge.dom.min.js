!function(e){e.extend({centrifuge_dom:function(n){function t(e){m.debug===!0&&console.log(e)}function r(e){var n,t=0;for(n in e)e.hasOwnProperty(n)&&t++;return t}function i(e){return m.fullMessage===!1?e.data:e}function o(e){return m.fullMessage===!1?e.body:e}function u(e){return m.fullMessage===!1?e.error:e}function c(e,n){var r=e.attr(m.channelAttr),i=n.getSubscription(r);return null===i&&t("no subscription found for channel "+r),i}function f(e){e.on("connect",function(){t("connected to Centrifuge"),g(e)}),e.on("error",function(e){t(e)}),e.on("disconnect",function(){t("disconnected from Centrifuge"),v()})}function s(e){p.on(m.eventPrefix+"publish",function(n){var t=$(this),r=c(t,e);r&&r.publish(n)}),p.on(m.eventPrefix+"presence",function(){var n=$(this),t=c(n,e);t&&t.presence(function(e){n.trigger("centrifuge-presence-message",i(e))})}),p.on(m.eventPrefix+"history",function(){var n=$(this),t=c(n,e);t&&t.history(function(e){n.trigger("centrifuge-history-message",i(e))})}),p.on(m.eventPrefix+"unsubscribe",function(){var n=$(this),t=c(n,e);t&&t.unsubscribe()})}function a(e,n){var r=b[e],c=n.subscribe(e,function(e){t(e);var n=r.attr(m.messageEventNameAttr),o=m.eventPrefix+(n||"message");r.trigger(o,i(e))});c.on("subscribe:success",function(e){var n=m.eventPrefix+"subscribe:success";r.trigger(n,o(e))}),c.on("subscribe:error",function(e){t(e);var n=m.eventPrefix+"subscribe:error";r.trigger(n,u(e))}),c.on("join",function(e){t(e);var n=m.eventPrefix+"join";r.trigger(n,i(e))}),c.on("leave",function(e){t(e);var n=m.eventPrefix+"leave";r.trigger(n,i(e))})}function l(e){var n=b[e];n.trigger(m.eventPrefix+"disconnect")}function g(e){for(var n in b)a(n,e)}function v(){for(var e in b)l(e)}function d(){p.each(function(n,t){var r=e(t),i=r.attr(m.channelAttr);b[i]=r})}var h={url:null,selector:".centrifuge",urlSelector:"#centrifuge-address",tokenSelector:"#centrifuge-token",userSelector:"#centrifuge-user",timestampSelector:"#centrifuge-timestamp",infoSelector:"#centrifuge-info",valueAttrName:"data-centrifuge-value",channelAttr:"data-centrifuge-channel",messageEventNameAttr:"data-centrifuge-message",eventPrefix:"centrifuge.",fullMessage:!0,debug:!1};this.centrifuge=null;var m=e.extend(h,n),b={},p=e(m.selector);return this.init=function(){if(!Centrifuge)return void console.log("No Centrifuge javascript client found");if(0===p.length)return void t("No Centrifuge handlers found on this page, nothing to do");var e=$(m.tokenSelector).attr(m.valueAttrName);if(!e)return void console.log("Centrifuge token not found");var n=$(m.userSelector).attr(m.valueAttrName);if(!n)return void console.log("Centrifuge user not found");var i=$(m.timestampSelector).attr(m.valueAttrName);if(!i)return void console.log("Centrifuge timestamp not found");var o;if(null===m.url&&(o=$(m.urlSelector).attr(m.valueAttrName)),!o)return void console.log("Centrifuge connection url not found");var u=$(m.infoSelector).attr(m.valueAttrName);u||(t("Centrifuge info not used, token must be generated without info part."),u=null);var c=new Centrifuge({url:o,token:e,user:n,timestamp:i,info:u});return d(c),0===r(b)?void t("No valid handlers found on page, no need in connection to Centrifuge"):(f(c),s(c),c.connect(),this.centrifuge=c,this)},this.init()}})}(jQuery);